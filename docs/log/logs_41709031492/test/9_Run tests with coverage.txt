2025-07-14T22:16:25.2965194Z ##[group]Run coverage run -m pytest tests/ -v
2025-07-14T22:16:25.2965533Z [36;1mcoverage run -m pytest tests/ -v[0m
2025-07-14T22:16:25.2965806Z [36;1mcoverage report --show-missing[0m
2025-07-14T22:16:25.2966041Z [36;1mcoverage xml[0m
2025-07-14T22:16:25.2991158Z shell: /usr/bin/bash -e {0}
2025-07-14T22:16:25.2991395Z env:
2025-07-14T22:16:25.2991637Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-07-14T22:16:25.2992051Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-07-14T22:16:25.2992439Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-07-14T22:16:25.2992791Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-07-14T22:16:25.2993123Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-07-14T22:16:25.2993458Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-07-14T22:16:25.2993742Z   BOOK_USER: testuser
2025-07-14T22:16:25.2993925Z   BOOK_PASS: testpass
2025-07-14T22:16:25.2994114Z   OPENAI_API_KEY: test-key
2025-07-14T22:16:25.2994331Z ##[endgroup]
2025-07-14T22:16:26.4952153Z ============================= test session starts ==============================
2025-07-14T22:16:26.4953175Z platform linux -- Python 3.12.11, pytest-8.4.1, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.12.11/x64/bin/python
2025-07-14T22:16:26.4954007Z cachedir: .pytest_cache
2025-07-14T22:16:26.4954517Z rootdir: /home/runner/work/book_triage_v0.1.0/book_triage_v0.1.0
2025-07-14T22:16:26.4955077Z configfile: pyproject.toml
2025-07-14T22:16:26.4955450Z plugins: cov-6.2.1, anyio-4.9.0
2025-07-14T22:16:29.9583092Z collecting ... collected 100 items
2025-07-14T22:16:29.9583393Z 
2025-07-14T22:16:30.1171002Z tests/test_api.py::TestAPIEndpoints::test_root_endpoint PASSED           [  1%]
2025-07-14T22:16:30.1683909Z tests/test_api.py::TestAPIEndpoints::test_health_endpoint PASSED         [  2%]
2025-07-14T22:16:30.2181964Z tests/test_api.py::TestAPIEndpoints::test_get_books_empty PASSED         [  3%]
2025-07-14T22:16:30.2731937Z tests/test_api.py::TestAPIEndpoints::test_get_books_with_data PASSED     [  4%]
2025-07-14T22:16:30.3488230Z tests/test_api.py::TestAPIEndpoints::test_upload_photo_success PASSED    [  5%]
2025-07-14T22:16:30.3997097Z tests/test_api.py::TestAPIEndpoints::test_scan_books_unauthorized PASSED [  6%]
2025-07-14T22:16:30.4496280Z tests/test_api.py::TestAPIEndpoints::test_rate_limiting_books_endpoint PASSED [  7%]
2025-07-14T22:16:30.5255005Z tests/test_api.py::TestAPIEndpoints::test_file_upload_size_limit PASSED  [  8%]
2025-07-14T22:16:30.5769717Z tests/test_api.py::TestAPIEndpoints::test_security_headers_in_response PASSED [  9%]
2025-07-14T22:16:30.6307876Z tests/test_api.py::TestAPIEndpoints::test_upload_photo_no_title_extracted PASSED [ 10%]
2025-07-14T22:16:30.6860054Z tests/test_api.py::TestAPIEndpoints::test_upload_photo_vision_processor_exception PASSED [ 11%]
2025-07-14T22:16:30.7375695Z tests/test_api.py::TestAPIEndpoints::test_upload_photo_no_file PASSED    [ 12%]
2025-07-14T22:16:30.7988720Z tests/test_api.py::TestAPIEndpoints::test_scan_books_success PASSED      [ 13%]
2025-07-14T22:16:30.8510561Z tests/test_api.py::TestAPIEndpoints::test_scan_books_exception PASSED    [ 14%]
2025-07-14T22:16:30.9034042Z tests/test_api.py::TestAPIEndpoints::test_rescan_title_record_not_found PASSED [ 15%]
2025-07-14T22:16:30.9550999Z tests/test_api.py::TestAPIEndpoints::test_add_manual_title_success PASSED [ 16%]
2025-07-14T22:16:31.0053458Z tests/test_api.py::TestAPIEndpoints::test_add_manual_title_missing_isbn PASSED [ 17%]
2025-07-14T22:16:31.0561655Z tests/test_api.py::TestAPIEndpoints::test_add_manual_title_invalid_isbn PASSED [ 18%]
2025-07-14T22:16:31.1038375Z tests/test_api.py::TestAPIInitialization::test_initialize_app PASSED     [ 19%]
2025-07-14T22:16:31.1126649Z tests/test_api.py::TestAPIInitialization::test_app_without_initialization PASSED [ 20%]
2025-07-14T22:16:31.1365454Z tests/test_cli.py::TestCLICommands::test_cli_help PASSED                 [ 21%]
2025-07-14T22:16:31.1429518Z tests/test_cli.py::TestCLICommands::test_scan_command_success PASSED     [ 22%]
2025-07-14T22:16:31.1495777Z tests/test_cli.py::TestCLICommands::test_scan_command_with_options PASSED [ 23%]
2025-07-14T22:16:31.1552830Z tests/test_cli.py::TestCLICommands::test_scan_command_no_records PASSED  [ 24%]
2025-07-14T22:16:31.1612447Z tests/test_cli.py::TestCLICommands::test_scan_command_nonexistent_file PASSED [ 25%]
2025-07-14T22:16:31.1677898Z tests/test_cli.py::TestCLICommands::test_scan_command_exception PASSED   [ 26%]
2025-07-14T22:16:31.1744533Z tests/test_cli.py::TestCLICommands::test_web_command_success PASSED      [ 27%]
2025-07-14T22:16:31.1808839Z tests/test_cli.py::TestCLICommands::test_web_command_with_options PASSED [ 28%]
2025-07-14T22:16:31.1871821Z tests/test_cli.py::TestCLICommands::test_web_command_nonexistent_file PASSED [ 29%]
2025-07-14T22:16:31.1929439Z tests/test_cli.py::TestCLICommands::test_web_command_exception PASSED    [ 30%]
2025-07-14T22:16:31.2028978Z tests/test_cli.py::TestCLICommands::test_create_csv_command_empty PASSED [ 31%]
2025-07-14T22:16:31.2118748Z tests/test_cli.py::TestCLICommands::test_create_csv_command_with_sample PASSED [ 32%]
2025-07-14T22:16:31.2179132Z tests/test_cli.py::TestCLICommands::test_create_csv_command_creates_directory PASSED [ 33%]
2025-07-14T22:16:31.2237239Z tests/test_cli.py::TestCLICommands::test_create_csv_command_exception PASSED [ 34%]
2025-07-14T22:16:31.2547348Z tests/test_cli.py::TestCLICommands::test_info_command_success PASSED     [ 35%]
2025-07-14T22:16:31.2596849Z tests/test_cli.py::TestCLICommands::test_info_command_nonexistent_file PASSED [ 36%]
2025-07-14T22:16:31.2651174Z tests/test_cli.py::TestCLICommands::test_info_command_exception PASSED   [ 37%]
2025-07-14T22:16:31.2729753Z tests/test_cli.py::TestCLIValidation::test_scan_cost_validation_min PASSED [ 38%]
2025-07-14T22:16:31.2801329Z tests/test_cli.py::TestCLIValidation::test_scan_cost_validation_max PASSED [ 39%]
2025-07-14T22:16:31.2872598Z tests/test_cli.py::TestCLIValidation::test_port_validation PASSED        [ 40%]
2025-07-14T22:16:31.2934760Z tests/test_cli.py::TestCLIIntegration::test_scan_integration_with_core PASSED [ 41%]
2025-07-14T22:16:31.2996808Z tests/test_cli.py::TestCLIIntegration::test_web_integration_with_api PASSED [ 42%]
2025-07-14T22:16:31.3135802Z tests/test_cli.py::TestCLIEnvironment::test_environment_loading PASSED   [ 43%]
2025-07-14T22:16:31.3274132Z tests/test_cli.py::TestCLIEnvironment::test_logging_configuration PASSED [ 44%]
2025-07-14T22:16:31.3338507Z tests/test_cli.py::TestCLIEnvironment::test_verbose_logging PASSED       [ 45%]
2025-07-14T22:16:31.3349728Z tests/test_core.py::TestBookRecord::test_book_record_creation PASSED     [ 46%]
2025-07-14T22:16:31.3361275Z tests/test_core.py::TestBookRecord::test_book_record_to_dict PASSED      [ 47%]
2025-07-14T22:16:31.3373146Z tests/test_core.py::TestBookRecord::test_book_record_with_all_fields PASSED [ 48%]
2025-07-14T22:16:31.3618993Z tests/test_core.py::TestBookTriage::test_book_triage_initialization_nonexistent_file PASSED [ 49%]
2025-07-14T22:16:31.3881590Z tests/test_core.py::TestBookTriage::test_book_triage_initialization_with_data PASSED [ 50%]
2025-07-14T22:16:31.4123498Z tests/test_core.py::TestBookTriage::test_calculate_utilities PASSED      [ 51%]
2025-07-14T22:16:31.4365509Z tests/test_core.py::TestBookTriage::test_calculate_utilities_with_none_values PASSED [ 52%]
2025-07-14T22:16:31.4602972Z tests/test_core.py::TestBookTriage::test_make_decision PASSED            [ 53%]
2025-07-14T22:16:31.4890531Z tests/test_core.py::TestBookTriage::test_add_record PASSED               [ 54%]
2025-07-14T22:16:31.5171441Z tests/test_core.py::TestBookTriage::test_get_record_by_id PASSED         [ 55%]
2025-07-14T22:16:31.5449066Z tests/test_core.py::TestBookTriage::test_price_to_v_calculation PASSED   [ 56%]
2025-07-14T22:16:31.5471617Z tests/test_core.py::TestBookTriage::test_enrich_with_gpt4o_mock PASSED   [ 57%]
2025-07-14T22:16:31.5932796Z tests/test_core.py::TestBookTriage::test_scan_cost_parameter PASSED      [ 58%]
2025-07-14T22:16:31.5944354Z tests/test_core.py::TestDecisionEnum::test_decision_values PASSED        [ 59%]
2025-07-14T22:16:31.5957900Z tests/test_core.py::TestDecisionEnum::test_decision_comparison PASSED    [ 60%]
2025-07-14T22:16:31.5974871Z tests/test_core_simple.py::TestBookRecord::test_book_record_creation PASSED [ 61%]
2025-07-14T22:16:31.5992694Z tests/test_core_simple.py::TestBookRecord::test_book_record_with_values PASSED [ 62%]
2025-07-14T22:16:31.6243727Z tests/test_core_simple.py::TestBookTriage::test_book_triage_initialization PASSED [ 63%]
2025-07-14T22:16:31.6479605Z tests/test_core_simple.py::TestBookTriage::test_calculate_utilities_simple PASSED [ 64%]
2025-07-14T22:16:31.6719227Z tests/test_core_simple.py::TestBookTriage::test_make_decision_simple PASSED [ 65%]
2025-07-14T22:16:31.6732971Z tests/test_core_simple.py::TestDecision::test_decision_values PASSED     [ 66%]
2025-07-14T22:16:31.6748493Z tests/test_vision.py::TestVisionProcessor::test_vision_processor_initialization_with_openai PASSED [ 67%]
2025-07-14T22:16:31.6759507Z tests/test_vision.py::TestVisionProcessor::test_vision_processor_initialization_without_openai PASSED [ 68%]
2025-07-14T22:16:31.6770536Z tests/test_vision.py::TestVisionProcessor::test_generate_id PASSED       [ 69%]
2025-07-14T22:16:31.6817124Z tests/test_vision.py::TestVisionProcessor::test_extract_title_from_image_openai_success PASSED [ 70%]
2025-07-14T22:16:31.6845006Z tests/test_vision.py::TestVisionProcessor::test_extract_title_from_image_fallback_to_tesseract PASSED [ 71%]
2025-07-14T22:16:31.6857424Z tests/test_vision.py::TestVisionProcessor::test_extract_title_from_image_nonexistent_file PASSED [ 72%]
2025-07-14T22:16:31.6878123Z tests/test_vision.py::TestVisionProcessor::test_extract_with_tesseract_success PASSED [ 73%]
2025-07-14T22:16:31.6901082Z tests/test_vision.py::TestVisionProcessor::test_extract_with_tesseract_empty_result PASSED [ 74%]
2025-07-14T22:16:31.6922449Z tests/test_vision.py::TestVisionProcessor::test_extract_with_tesseract_error PASSED [ 75%]
2025-07-14T22:16:31.6962674Z tests/test_vision.py::TestVisionProcessor::test_extract_with_openai_vision_no_content PASSED [ 76%]
2025-07-14T22:16:31.6991390Z tests/test_vision.py::TestVisionProcessor::test_extract_with_openai_vision_no_client PASSED [ 77%]
2025-07-14T22:16:31.7036922Z tests/test_vision.py::TestVisionProcessor::test_extract_title_and_isbn_from_image_success PASSED [ 78%]
2025-07-14T22:16:31.7057014Z tests/test_vision.py::TestVisionProcessor::test_extract_title_and_isbn_tesseract_fallback PASSED [ 79%]
2025-07-14T22:16:31.7069408Z tests/test_vision.py::TestVisionProcessor::test_extract_title_and_isbn_nonexistent_file PASSED [ 80%]
2025-07-14T22:16:31.7089097Z tests/test_vision.py::TestVisionProcessor::test_extract_title_and_isbn_no_isbn_found PASSED [ 81%]
2025-07-14T22:16:31.7119564Z tests/test_vision.py::TestVisionProcessor::test_image_format_conversion PASSED [ 82%]
2025-07-14T22:16:31.7143448Z tests/test_vision.py::TestVisionProcessorIntegration::test_processor_with_real_image_mock_ocr PASSED [ 83%]
2025-07-14T22:16:31.7160891Z tests/test_vision_fixed.py::TestVisionProcessor::test_vision_processor_initialization_with_openai PASSED [ 84%]
2025-07-14T22:16:31.7172031Z tests/test_vision_fixed.py::TestVisionProcessor::test_vision_processor_initialization_without_openai PASSED [ 85%]
2025-07-14T22:16:31.7183029Z tests/test_vision_fixed.py::TestVisionProcessor::test_generate_id PASSED [ 86%]
2025-07-14T22:16:31.7195341Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_title_from_image_nonexistent_file PASSED [ 87%]
2025-07-14T22:16:31.7245089Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_title_with_openai_vision_success PASSED [ 88%]
2025-07-14T22:16:31.7271451Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_title_fallback_to_tesseract PASSED [ 89%]
2025-07-14T22:16:31.7293842Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_with_tesseract_success PASSED [ 90%]
2025-07-14T22:16:31.7314303Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_with_tesseract_empty_result PASSED [ 91%]
2025-07-14T22:16:31.7335550Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_with_tesseract_error PASSED [ 92%]
2025-07-14T22:16:31.7376106Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_with_openai_vision_no_content PASSED [ 93%]
2025-07-14T22:16:31.7392661Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_with_openai_vision_no_client PASSED [ 94%]
2025-07-14T22:16:31.7432834Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_title_and_isbn_from_image_success PASSED [ 95%]
2025-07-14T22:16:31.7452875Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_title_and_isbn_tesseract_fallback PASSED [ 96%]
2025-07-14T22:16:31.7465232Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_title_and_isbn_nonexistent_file PASSED [ 97%]
2025-07-14T22:16:31.7484820Z tests/test_vision_fixed.py::TestVisionProcessor::test_extract_title_and_isbn_no_isbn_found PASSED [ 98%]
2025-07-14T22:16:31.7495982Z tests/test_vision_fixed.py::TestVisionProcessor::test_image_format_conversion PASSED [ 99%]
2025-07-14T22:16:31.9456591Z tests/test_vision_fixed.py::TestVisionProcessorIntegration::test_processor_with_real_image_mock_ocr PASSED [100%]
2025-07-14T22:16:31.9457681Z 
2025-07-14T22:16:31.9457944Z ============================= 100 passed in 5.27s ==============================
2025-07-14T22:16:32.2685101Z Name                      Stmts   Miss  Cover   Missing
2025-07-14T22:16:32.2685699Z -------------------------------------------------------
2025-07-14T22:16:32.2686208Z book_triage/__init__.py       3      0   100%
2025-07-14T22:16:32.2686807Z book_triage/__main__.py      21     21     0%   3-39
2025-07-14T22:16:32.2687546Z book_triage/api.py          156     35    78%   41, 66, 396, 465, 491, 495-529, 540, 542
2025-07-14T22:16:32.2688383Z book_triage/cli.py          117      8    93%   229, 231, 233, 235, 237, 239, 241, 250
2025-07-14T22:16:32.2689032Z book_triage/core.py         169     30    82%   101-102, 107, 110-111, 153-155, 160-161, 202, 211, 220-221, 226, 252-254, 257-258, 262, 271-286
2025-07-14T22:16:32.2689706Z book_triage/security.py      45     14    69%   27, 37-48, 64-69, 83, 89-90
2025-07-14T22:16:32.2690202Z book_triage/vision.py        94      7    93%   156-157, 163, 165-166, 168-169
2025-07-14T22:16:32.2690625Z -------------------------------------------------------
2025-07-14T22:16:32.2691768Z TOTAL                       605    115    81%
2025-07-14T22:16:32.2692190Z Coverage failure: total of 81 is less than fail-under=84
2025-07-14T22:16:32.2873107Z ##[error]Process completed with exit code 2.
