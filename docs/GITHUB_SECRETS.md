# GitHub Secrets Configuration

This document outlines all the GitHub repository secrets required for the Book Triage project's CI/CD pipeline and deployment.

## Required Secrets

### üîí CODECOV_TOKEN

**Purpose**: Enables code coverage reporting to Codecov.io for tracking test coverage metrics.

**How to obtain**:
1. Sign up for a free account at [codecov.io](https://codecov.io)
2. Connect your GitHub repository to Codecov
3. Navigate to your repository settings in Codecov
4. Copy the repository upload token

**How to add to GitHub**:
1. Go to your repository on GitHub
2. Navigate to `Settings` ‚Üí `Secrets and variables` ‚Üí `Actions`
3. Click `New repository secret`
4. Name: `CODECOV_TOKEN`
5. Value: Paste the token from Codecov
6. Click `Add secret`

**Usage in CI**: Used in the `test` job to upload coverage reports after running pytest with coverage.

---

### üì¢ SLACK_WEBHOOK (Optional)

**Purpose**: Sends notifications to Slack when CI pipeline fails.

**How to obtain**:
1. Create a Slack app or use an existing one
2. Enable incoming webhooks for your workspace
3. Create a webhook for the desired channel (e.g., `#ci-alerts`)
4. Copy the webhook URL

**How to add to GitHub**:
1. Follow the same steps as CODECOV_TOKEN
2. Name: `SLACK_WEBHOOK`
3. Value: Your Slack webhook URL

**Usage in CI**: Used in the `notify` job to send failure notifications.

---

## Environment Variables vs Secrets

### Public Environment Variables
These are set directly in the workflow and don't need to be secrets:

```yaml
- name: Set environment variables
  run: |
    echo "BOOK_USER=testuser" >> $GITHUB_ENV
    echo "BOOK_PASS=testpass" >> $GITHUB_ENV
    echo "OPENAI_API_KEY=test-key" >> $GITHUB_ENV
```

These are safe because they're only test values used in CI, not production credentials.

### When to Use Secrets
Use GitHub secrets for:
- **Production API keys** (if deploying)
- **Third-party service tokens** (Codecov, Slack)
- **Authentication credentials** for external services
- **Signing keys** or certificates

## Setup Checklist

### Essential (Required for CI to work)
- [x] `CODECOV_TOKEN` - For code coverage reporting

### Optional (Enhances CI experience)
- [ ] `SLACK_WEBHOOK` - For failure notifications

## Verification

After adding secrets, verify they work by:

1. **CODECOV_TOKEN**: 
   - Push a commit and check the CI workflow
   - Look for successful coverage upload in the test job
   - Visit your Codecov dashboard to see coverage reports

2. **SLACK_WEBHOOK**:
   - Temporarily break a test to trigger a failure
   - Check if Slack notification is received
   - Fix the test and verify success

## Security Best Practices

### ‚úÖ Do:
- Use repository secrets for sensitive data
- Regularly rotate tokens and webhooks
- Use least-privilege access for service accounts
- Monitor secret usage in workflow logs

### ‚ùå Don't:
- Hardcode secrets in workflow files
- Use personal access tokens for service integration
- Share secrets between repositories unless necessary
- Log secret values (GitHub automatically masks them)

## Troubleshooting

### CODECOV_TOKEN Issues

**Problem**: Coverage upload fails with authentication error
**Solution**: 
1. Verify the token is correctly copied from Codecov
2. Check that the repository is properly connected to Codecov
3. Ensure the secret name is exactly `CODECOV_TOKEN`

**Problem**: Coverage reports not appearing on Codecov
**Solution**:
1. Check that coverage.xml is being generated by pytest-cov
2. Verify the codecov action is using the correct file path
3. Ensure the repository is public or you have a Codecov Pro account

### SLACK_WEBHOOK Issues

**Problem**: No Slack notifications received
**Solution**:
1. Test the webhook URL manually with curl
2. Check Slack app permissions and channel access
3. Verify the secret is named exactly `SLACK_WEBHOOK`

**Problem**: Notifications sent for every run instead of just failures
**Solution**: Check that the notify job has `if: failure()` condition

## Alternative Coverage Services

If you prefer not to use Codecov, you can:

1. **GitHub Actions Artifacts**: Upload coverage reports as build artifacts
2. **Coveralls**: Similar to Codecov with different pricing
3. **SonarCloud**: Comprehensive code quality including coverage
4. **Local Reports**: Generate HTML reports and host them yourself

To disable Codecov integration:
1. Remove the `CODECOV_TOKEN` secret
2. Comment out or remove the codecov upload steps in the workflow
3. Keep the coverage generation for local use

## Contact

For questions about secret configuration, check:
- [GitHub Secrets Documentation](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [Codecov Documentation](https://docs.codecov.io/docs)
- Project maintainers via GitHub issues 